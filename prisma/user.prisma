// ============================================
// USER & AUTHENTICATION
// ============================================

model User {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  email         String   @unique
  emailVerified Boolean  @default(false)
  passwordHash  String?  // For custom auth, or use external auth service
  fullName      String?
  phone         String?
  

  
  // Role & Permissions (hierarchical)
  role          UserRole @default(BUYER)
  isActive      Boolean  @default(true)
  isSuspended   Boolean  @default(false)
  suspensionReason String?
  suspensionUntil DateTime?
  
  // Financial
  walletBalance Float    @default(0) // In USD
  currency      String   @default("USD") // Primary currency preference
  
  // Preferences
  language      String   @default("en")
  timezone      String   @default("Africa/Lagos")
  notificationPreferences Json? // { email: true, sms: false, push: true }
  
  // Metadata
  lastLoginAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  profile       Profile?
  orders        Order[]
  payments      Payment[]
  savedVehicles SavedVehicle[]
  messages      Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  activityLogs ActivityLog[]
  adminNotes    AdminNote[]
  
  @@index([email])
  @@index([role])
  @@index([country])
  @@index([isActive])
  @@map("users")
}

enum UserRole {
  BUYER
  OPERATIONS_ADMIN
  SUPER_ADMIN
}

model Profile {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  userId          String   @unique @db.ObjectId
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Extended profile data
  avatar          String?

  files FileInfo[]
  addresses Address[] 
  dateOfBirth     DateTime?
  identificationNumber String? // For KYC
  identificationType   String? // passport, national_id, etc.
  identificationDocument String? // URL to document
  
  // Business info (if applicable)
  businessName    String?
  taxId           String?
  
  // Verification
  isVerified      Boolean  @default(false)
  verifiedAt      DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("profiles")
}