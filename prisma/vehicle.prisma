
// ============================================
// VEHICLES (API + Manual)
// ============================================
model Vehicle {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  vin           String   @unique // VIN is always unique
  slug          String   @unique // SEO-friendly URL slug (e.g., "2021-toyota-camry-abc123")
  
  // Basic Info
  make          String
  model         String
  year          Int
  vehicleType   VehicleType
  
  // Pricing (flexible for price changes)
  priceUsd      Float
  originalPriceUsd Float? // Original price when first added
  priceHistory  Json[] // [{ date, price, reason }] for tracking changes
  
  // Vehicle Details
  mileage       Int?
  engineSize    String?
  transmission  String?
  fuelType      String?
  drivetrain    String? // AWD, FWD, RWD
  exteriorColor String?
  interiorColor String?
  bodyStyle     String?
  
  // Location
  dealerName    String?
  dealerState   String?
  dealerCity    String?
  dealerZipCode String?
  dealerCountry String  @default("USA")
  dealerPhone   String?
  dealerWebsite String?
  
  // Media
  images        String[] @default([])
  videos        String[] @default([])
  thumbnail     String? // Primary image URL
  
  // Features & Specs
  features      String[] @default([])
  specifications Json? // Flexible spec storage
  
  // API Integration (Auto.dev)
  source        VehicleSource @default(API)
  apiProvider   String? // "autodev", "other"
  apiListingId  String? // External API listing ID
  apiData       Json? // Full API response cache
  lastApiSync   DateTime? // Last time synced from API
  apiSyncStatus ApiSyncStatus @default(PENDING)
  apiSyncError  String? // Error message if sync failed
  
  // Manual Listing Fields
  addedBy       String? @db.ObjectId // Admin user ID
  addedByName   String?
  manualNotes   String?
  
  // Status & Availability
  status        VehicleStatus @default(AVAILABLE)
  availability  VehicleAvailability @default(IN_STOCK)
  featured      Boolean  @default(false)
  featuredUntil DateTime?
  
  // Admin Controls
  isActive      Boolean  @default(true)
  isHidden      Boolean  @default(false)
  hideReason    String?
  
  // Metadata
  viewCount     Int      @default(0)
  saveCount     Int      @default(0) // How many users saved this
  requestCount  Int      @default(0) // How many requests for this vehicle
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  orders        Order[]
  savedVehicles SavedVehicle[]

  
  
  @@index([slug])
  @@index([make, model])
  @@index([year])
  @@index([vehicleType])
  @@index([priceUsd])
  @@index([status])
  @@index([source])
  @@index([apiListingId])
  @@index([featured])
  @@index([isActive, isHidden])
  @@index([dealerState])
  @@map("vehicles")
}

enum VehicleType {
  CAR
  SUV
  TRUCK
  VAN
  COUPE
  SEDAN
  HATCHBACK
  WAGON
  CONVERTIBLE
  MOTORCYCLE
  OTHER
}

enum VehicleSource {
  API
  MANUAL
  IMPORTED
}

enum ApiSyncStatus {
  PENDING
  SYNCED
  FAILED
  OUTDATED
}

enum VehicleStatus {
  AVAILABLE
  PENDING
  SOLD
  UNAVAILABLE
  RESERVED
}

enum VehicleAvailability {
  IN_STOCK
  IN_TRANSIT
  AT_PORT
  READY_FOR_PICKUP
  OUT_OF_STOCK
}

model SavedVehicle {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  vehicleId String   @db.ObjectId
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([userId, vehicleId])
  @@index([userId])
  @@index([vehicleId])
  @@map("saved_vehicles")
}